多くのアプリケーションで、開発者はクラスを読み込むためのファイルや、複数のウェブページ間でテンプレートを共有するためのファイルをインクルードする必要があります。   

ファイルインクルード脆弱性は、インクルード関数（require, require_once, include, include_once in PHP など）の呼び出しにおいて、ユーザ制御のパラメータがファイル名の一部として使用される際のフィルタリング不足に起因しています。これらのメソッドの呼び出しに脆弱性がある場合、攻撃者はその関数を操作して自 分のコードを読み込むことができるようになります。また、ファイルインクルード脆弱性は、ディレクトリトラバーサルとして、任意のファイルを読み込むために使用される可能性があります。しかし、任意のコードに PHP の開始タグが含まれている場合、そのファイルは PHP のコードとして解釈されます。   

このインクルード機能により、ローカルリソースやリモートリソース（Webサイトなど）の読み込みが可能になります。脆弱性がある場合、それが原因となります。   

- ローカルファイル インクルード：LFI.ローカルファイルが読み込まれ、解釈される。  
- リモートファイルインクルード：RFI.リモートファイルが読み込まれ、解釈されます。
   
デフォルトでは、PHP は設定オプション allow_url_include によりリモートファイルの読み込みを無効にしています。ISO では、テストできるようにこのオプションを有効にしています。
# <span style="color: blue;">Example 1</span>
パラメータに特殊文字（例えば引用符）を挿入するとすぐに、エラーメッセージが表示されるのがわかります。   
エラーメッセージを注意深く読むと、多くの情報を抽出することができます。

- スクリプトのパス：/var/www/fileincl/example1.php。
- 使用された関数: include()。
- includeの呼び出しで使用されている値は、追加やフィルタリングを行わずに ' を注入した値です。  

ディレクトリトラバーサルを検出するために使用される方法を、ファイルのインクルードを検出するために使用することができます。
![8bd2f14417faab1635ab8ae93ad9c31b.png](../../_resources/8bd2f14417faab1635ab8ae93ad9c31b.png)
![009d1d3b7b60fb9a8320d393ff58ef1b.png](../../_resources/009d1d3b7b60fb9a8320d393ff58ef1b.png)   
![230e091fa6c68fb0c22fef2deb7ac4cb.png](../../_resources/230e091fa6c68fb0c22fef2deb7ac4cb.png)   
![a1217f2bf04ecdac22988eca48dfbc38.png](../../_resources/a1217f2bf04ecdac22988eca48dfbc38.png)   
外部リソースを要求することによって、リモートファイルインクルードをテストすることができます。   
![0a47345ac01914e21b0d7ce36df1ee7a.png](../../_resources/0a47345ac01914e21b0d7ce36df1ee7a.png)   

# <span style="color: blue;">Example 2</span>
ディレクトリトラバーサルと同様の方法で、この例では提供された値に独自のサフィックスを追加します。前と同様に、NULL BYTEを使用してサフィックスを取り除くことができます(LFIについて)。   

![028edbd7dba9480a9d91e1b74fbc56df.png](../../_resources/028edbd7dba9480a9d91e1b74fbc56df.png)   
![7cc80b42058c940ca78758304c1f3c71.png](../../_resources/7cc80b42058c940ca78758304c1f3c71.png)   

![129f47d091b66fd9fe8b9f31858f588d.png](../../_resources/129f47d091b66fd9fe8b9f31858f588d.png)
RFI の場合は、URL に応じて &blah= あるいは ?blah= を追加することでサフィックスを取り除くこともできる。